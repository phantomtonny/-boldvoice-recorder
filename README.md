# BoldVoice Recorder

Bold Voiceサイトでの音声判定と同時に録音を行い、自動的にファイルを保存するChrome拡張機能です。

## 機能

- Bold Voiceでの音声入力時に自動で録音を開始
- 判定結果から最高スコアの言語を自動判定
- 言語別フォルダに録音ファイルを自動保存
- 100ファイルごとにサブフォルダを自動作成
- **RMSベースの無音検出** - 小声の音声も保護しながら、長い無音部分を自動削除 (v0.2.3+)
- **録音中インジケーター** - 拡張機能が録音中であることを明示表示 (v0.2.4+)

## インストール

1. このリポジトリをクローンまたはダウンロード
2. Chromeブラウザで `chrome://extensions/` を開く
3. 右上の「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. このプロジェクトフォルダを選択

## 使い方

1. 拡張機能のオプションページで保存先フォルダ名を設定（デフォルト: BoldVoiceRec）
2. Bold Voiceのサイトにアクセス
3. 通常通り音声入力を行う
4. 自動的に録音が開始され、判定完了後にファイルが保存されます

## ファイル保存形式

```
ダウンロードフォルダ/
└── BoldVoiceRec/           # 親フォルダ（設定で変更可能）
    └── en_us/              # 言語フォルダ
        ├── 001-100/        # 100件ごとのサブフォルダ
        │   ├── en_us_20251115_0001.webm
        │   ├── en_us_20251115_0002.webm
        │   └── ...
        └── 101-200/
            └── ...
```

## 技術仕様

- Manifest Version: 3
- 録音形式: WebM
- 対応ブラウザ: Google Chrome（最新版推奨）

### 無音検出アルゴリズム (v0.2.3+)

録音後、自動的に無音部分を検出して削除します：

- **RMS（二乗平均平方根）ベースの検出**
  - 50msウィンドウで音声エネルギーを計算
  - 単純な振幅閾値ではなく、平均エネルギーで判定

- **小声の保護**
  - RMS閾値0.01で、小さな声も音声として認識
  - 背景ノイズと小声を区別

- **適度な無音削除**
  - 1.0秒以上の無音のみを0.5秒に短縮
  - 短い休憩や呼吸の間は保護

この機能により、録音ファイルのサイズを削減しながら、音声品質を保ちます。

## 開発

### 必要な権限
- `downloads`: ファイルのダウンロード
- `storage`: 設定の保存
- `scripting`: コンテンツスクリプトの注入
- `activeTab`: アクティブタブへのアクセス

### ファイル構成
- `manifest.json`: 拡張機能の設定
- `background.js`: バックグラウンドで動作するService Worker
- `content.js`: Bold Voiceページに注入されるスクリプト
- `options.html/js`: 設定画面

## ライセンス

MIT

## プライバシーとセキュリティ

### データの取り扱い

**重要：** この拡張機能は以下の原則に基づいて設計されています：

- ✅ **完全ローカル保存のみ** - 録音データは一切外部サーバーに送信されません
- ✅ **ネットワーク通信なし** - この拡張はインターネット接続を使用しません
- ✅ **BoldVoiceドメインのみ** - BoldVoiceサイト以外では動作しません
- ✅ **最小限の権限** - 必要最小限の権限のみを要求します

### 音声データの取り扱いについて

⚠️ **録音された音声ファイルは生体情報に該当します**

- 音声データから個人を特定できる可能性があります
- PC を他人と共有している場合は特に注意してください
- 録音ファイルが漏洩した場合、声から本人を特定されるリスクがあります
- ファイル名に言語情報が含まれるため、学習状況が推測される可能性があります

**推奨事項：**
- 録音ファイルは重要な個人情報として扱ってください
- 不要になったファイルは適切に削除してください
- PC のセキュリティ対策（ディスク暗号化等）を検討してください

### セキュリティ対策

この拡張機能は以下のセキュリティ対策を実装しています：

1. **ファイル名のサニタイズ** - パストラバーサル攻撃を防ぐため、安全な文字のみを使用
2. **権限の制限** - BoldVoiceドメイン以外では動作しません
3. **入力検証** - DOM から取得したデータは厳格に検証されます
4. **履歴の制限** - 保存される履歴は最新1000件のみ（パフォーマンス対策）
5. **音声処理のエラーハンドリング** - 無音検出処理でエラーが発生した場合、元の録音を安全に保存

### 派生版・改造版に関する警告

⚠️ **この拡張機能のフォークや改造版を使用する場合は注意してください**

本家版（公式リポジトリ）は以下を保証します：
- 録音データの外部送信は一切行いません
- `manifest.json`に不要な権限を要求しません

もし以下の動作をする版を見つけた場合、**悪意ある改造版の可能性があります**：
- ネットワーク通信を行う
- `host_permissions`に`https://*/*`など広範な権限がある
- 不審なサーバーへのデータ送信コードが含まれる

**安全のため、必ず公式リポジトリからダウンロードしてください。**

## 注意事項

- Bold VoiceのDOM構造が変更された場合、動作しなくなる可能性があります
- マイクへのアクセス許可が必要です
- ファイルはブラウザのダウンロードフォルダ配下にのみ保存可能です
